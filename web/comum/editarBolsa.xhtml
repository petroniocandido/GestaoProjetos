<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets" 
                xmlns:pe="http://primefaces.org/ui/extensions">
    <p:panel>
        <f:facet name="header">
            Editar Bolsa 
        </f:facet>
        <p:tabView id="tabView">  
            <p:tab rendered="#{autenticacaoController.autorizacao('tabProjetoDadosGerais')}"  title="Dados Gerais">  
                <h:panelGrid columns="2">

                    <h:outputLabel value="Situação:" />
                    <p:selectOneMenu value="#{bolsaController.entidade.situacao}" disabled="#{not bolsaController.admin}">
                        <f:selectItems value="${bolsaController.situacoesProjeto}"/>
                    </p:selectOneMenu>

                    <h:outputLabel value="Status:" />
                    <h:outputLabel value="#{bolsaController.entidade.status}" />

                    <h:outputLabel value="Projeto*:" />                             
                    <p:autoComplete  converter="#{projetoConverter}" value="#{bolsaController.entidade.projeto}"
                                     completeMethod="#{projetoConverter.autoCompleteProjeto}"
                                     var="item" itemLabel="#{item.titulo}" itemValue="#{item}"
                                      disabled="#{not bolsaController.alteraDadosGerais}">
                        #{item.titulo}
                    </p:autoComplete>
                    
                    <h:outputLabel value="Orientando*:" />                 

                    <p:autoComplete converter="#{alunoConverter}" value="#{bolsaController.entidade.orientando}"
                                    completeMethod="#{alunoConverter.autoCompleteAluno}" 
                                    var="item" itemLabel="#{item.nome}" itemValue="#{item}">
                        #{item.nome}
                    </p:autoComplete>

                    <h:outputLabel value="Modalidade*:" />                   
                    <p:selectOneMenu value="${bolsaController.entidade.modalidade}" label="Modalidade"  disabled="#{not bolsaController.admin}"
                                     converter="${modalidadeConverter}" required="false" >
                        <f:selectItem itemLabel="Selecione..." noSelectionOption="true"/>
                        <f:selectItems value="${modalidadeController.listagem}"/>

                    </p:selectOneMenu>

                    <h:outputLabel value="Agência Financiadora*:" />                    
                    <p:selectOneMenu value="${bolsaController.entidade.agenciaFinanciadora}" label="agenciaFinanciadora" 
                                     converter="${agenciaFinanciadoraConverter}" required="false"  disabled="#{not bolsaController.admin}" >
                        <f:selectItem itemLabel="Selecione..." noSelectionOption="true"/>
                        <f:selectItems value="${agenciaFinanciadoraController.listagem}"/>

                    </p:selectOneMenu>

                    <h:outputLabel value="Edital*:" />                    
                    <p:selectOneMenu value="${bolsaController.entidade.edital}" label="edital"  disabled="#{not bolsaController.admin}"
                                     converter="${editalConverter}" required="false" >
                        <f:selectItem itemLabel="Selecione..." noSelectionOption="true"/>
                        <f:selectItems value="${editalController.listagem}"/>

                    </p:selectOneMenu>

                    <h:outputLabel value="Data de Início*:" />
                    <p:calendar value="${bolsaController.entidade.dataInicio}" required="false"
                                label="Data de Início" pattern="dd/MM/yyyy" locale="pt_BR"  disabled="#{not bolsaController.alteraDadosGerais}"/>  

                    <h:outputLabel value="Data de Término*:" />
                    <p:calendar value="${bolsaController.entidade.dataTermino}" required="false"
                                label="Data de Início" pattern="dd/MM/yyyy" locale="pt_BR"  disabled="#{not bolsaController.alteraDadosGerais}"/>  

                </h:panelGrid>
            </p:tab>
  
            <p:tab rendered="#{bolsaController.entidade.id > 0  and autenticacaoController.autorizacao('tabProjetoCronograma')}" 
                   title="Cronograma">

                <p:panelGrid rendered="#{bolsaController.alteraDadosGerais}" columns="2"> 
                    <h:outputLabel value="Situação:" />
                    <p:selectOneMenu  id="somCronogramaSituacao" value="#{bolsaController.atividade.situacao}">
                        <f:selectItem itemLabel="Selecione..." noSelectionOption="true"/>
                        <f:selectItems value="${bolsaController.situacoesAtividade}"/>
                    </p:selectOneMenu>

                    <h:outputLabel value="Descrição:" />
                    <p:inputTextarea  id="txtCronogramaDescricao" value="${bolsaController.atividade.descricao}" cols="100" rows="4" />

                    <h:outputLabel value="Data Início*:" />
                    <p:calendar  id="txtCronogramaDataInicio" value="${bolsaController.atividade.dataInicio}" required="false"
                                label="Data Inicio" pattern="dd/MM/yyyy" locale="pt_BR"/>

                    <h:outputLabel value="Data Fim*:" />
                    <p:calendar  id="txtCronogramaDataFim" value="${bolsaController.atividade.dataFim}" required="false"
                                label="Data Inicio" pattern="dd/MM/yyyy" locale="pt_BR"/>

                    <h:outputLabel value="Ordem*:" />
                    <pe:inputNumber  id="txtCronogramaOrdem" value="${bolsaController.atividade.ordem}"
                                    decimalPlaces="0" decimalSeparator="">
                        <f:convertNumber integerOnly="true"/>
                    </pe:inputNumber> 

                    <p:commandButton  value="Adicionar" icon="ui-icon-check" 
                                     action="${bolsaController.addAtividade()}"
                                     update="tblAtividades somCronogramaSituacao txtCronogramaDescricao txtCronogramaDataInicio txtCronogramaDataFim 
                                     txtCronogramaOrdem" /> 

                </p:panelGrid>
                <p:dataTable id="tblAtividades" value="${bolsaController.entidade.cronogramaAtividade}" 
                             var="item" emptyMessage="Registros não Encontrados!" 
                             style="font: medium; color: blue">

                    <p:column sortBy="ordem" headerText="Ordem">
                        ${item.ordem}
                    </p:column>

                    <p:column sortBy="descrcao" headerText="Descrição">
                        ${item.descricao}
                    </p:column>

                    <p:column sortBy="dataInicio" headerText="Data Início">
                        <h:outputLabel value="${item.dataInicio}">
                            <f:convertDateTime pattern="MM/yyyy" />
                        </h:outputLabel>
                    </p:column>

                    <p:column sortBy="dataFim" headerText="Data Fim">
                        <h:outputLabel value="${item.dataFim}">
                            <f:convertDateTime pattern="dd/MM/yyyy" />
                        </h:outputLabel>
                    </p:column>

                    <p:column rendered="#{bolsaController.alteraDadosGerais}" sortBy="editar" headerText="Editar">
                        <p:commandButton ajax="false" value="Editar" >
                            <f:setPropertyActionListener target="#{bolsaController.atividade}" value="#{item}" />
                        </p:commandButton>
                    </p:column>

                    <p:column  rendered="#{bolsaController.alteraDadosGerais}" sortBy="remover" headerText="Remover" >
                        <p:commandButton ajax="false" value="Remover" action="#{bolsaController.removeAtividade()}">
                            <f:setPropertyActionListener target="#{bolsaController.atividade}" value="#{item}" />
                        </p:commandButton>
                    </p:column>                           

                </p:dataTable>

            </p:tab>

            <p:tab rendered="#{bolsaController.entidade.id > 0  and autenticacaoController.autorizacao('tabProjetoAcompanhamento')}" 
                   title="Acompanhamento Atividades">
                <h:panelGrid columns="2">
                    <h:outputLabel value="Atividade:" />
                    <p:selectOneMenu id="txtAtividadeAcompanhamento" value="${bolsaController.acompanhamento.atividade}" 
                                     converter="${atividadeConverter}" required="false">
                        <f:selectItem itemLabel="Selecione..." noSelectionOption="false"/>
                        <f:selectItems value="${bolsaController.entidade.cronogramaAtividade}"/>
                    </p:selectOneMenu>
                    <h:outputLabel value="Descrição do trabalho:" />
                    <p:inputTextarea id="txtDescricaoAcompanhamento" value="${bolsaController.acompanhamento.descricao}" 
                                     rows="3" cols="120"/>
                </h:panelGrid>
                <h:panelGrid columns="4">
                    <h:outputLabel value="Início:" />
                    <p:calendar id="txtDataInicioAcompanhamento" value="${bolsaController.acompanhamento.dataInicio}" required="false"
                                label="Data Inicio" pattern="dd/MM/yyyy" locale="pt_BR"/>

                    <h:outputLabel value="Termino:" />
                    <p:calendar id="txtDataTerminoAcompanhamento" value="${bolsaController.acompanhamento.dataFim}" required="false"
                                label="Data Inicio" pattern="dd/MM/yyyy" locale="pt_BR"/>

                    <p:commandButton value="Adicionar" action="#{bolsaController.addAcompanhamento()}" 
                                     update="txtAtividadeAcompanhamento txtDescricaoAcompanhamento txtDataInicioAcompanhamento 
                                     txtDataTerminoAcompanhamento tblAcompanhamento" />
                </h:panelGrid>
                <p:dataTable id="tblAcompanhamento" value="${bolsaController.entidade.acompanhamentoAtividades}" 
                             var="item" emptyMessage="Registros não Encontrados!" >
                    <p:column headerText="Início">
                        <h:outputLabel value="${item.dataInicio}">
                            <f:convertDateTime pattern="dd/MM/yyyy" />
                        </h:outputLabel>
                    </p:column>
                    <p:column headerText="Atividade">
                        ${item.atividade}
                    </p:column>
                    <p:column headerText="Descrição">
                        ${item.descricao}
                    </p:column>
                    <p:column headerText="Participante">
                        ${item.pessoa}
                    </p:column>
                    <p:column sortBy="editar" headerText="Editar">
                        <p:commandButton ajax="false" value="Editar" >
                            <f:setPropertyActionListener target="#{bolsaController.acompanhamento}" value="#{item}" />
                        </p:commandButton>
                    </p:column>
                </p:dataTable>
            </p:tab>

            <p:tab rendered="#{bolsaController.entidade.id > 0  and autenticacaoController.autorizacao('tabProjetoDocumentos')}" 
                   title="Documentos">
                <h:panelGrid  rendered="#{bolsaController.alteraDadosGerais}" columns="4">
                    <h:outputLabel value="Tipo de Documento*:" />
                    <p:selectOneMenu id="txtTipoDocumento" value="${bolsaController.documento.tipoDocumento}" label="Tipo de Documento"
                                     converter="${tipoDocumentoConverter}" required="false">
                        <f:selectItem itemLabel="Selecione..." noSelectionOption="false"/>
                        <f:selectItems value="${tipoDocumentoController.listagem}"/>

                    </p:selectOneMenu>

                    <h:outputLabel value="Data Prevista*:" />
                    <p:calendar id="txtDataPrevista" value="${bolsaController.documento.dataPrevista}" required="false"
                                label="Data Prevista" pattern="dd/MM/yyyy" locale="pt_BR"/>

                    <h:outputLabel value="Data Efetiva*:" />
                    <p:calendar id="txtDataEfetiva" value="${bolsaController.documento.dataEfetiva}" required="false"
                                label="Data Efetiva" pattern="dd/MM/yyyy" locale="pt_BR"/>


                    <p:commandButton value="Adicionar" icon="ui-icon-check" 
                                     action="${bolsaController.addDocumento()}" style="margin:0"
                                     update="tblTipoDocumento txtTipoDocumento txtDataPrevista txtDataEfetiva" /> 

                </h:panelGrid>
                <p:dataTable id="tblTipoDocumento" value="${bolsaController.entidade.documentos}" 
                             var="item" emptyMessage="Registros não Encontrados!" >

                    <p:column sortBy="funcionarioRecebedor" headerText="Funcionário Recebedor">
                        ${item.funcionarioRecebedor}
                    </p:column>

                    <p:column sortBy="tipoDocumento" headerText="Tipo de Documento">
                        ${item.tipoDocumento}
                    </p:column>

                    <p:column sortBy="dataPrevista" headerText="Data Prevista">
                        <h:outputLabel value="${item.dataPrevista}">
                            <f:convertDateTime pattern="MM/yyyy" />
                        </h:outputLabel>
                    </p:column>

                    <p:column sortBy="dataEfetiva" headerText="Data Efetiva">
                        <h:outputLabel value="${item.dataEfetiva}">
                            <f:convertDateTime pattern="dd/MM/yyyy" />
                        </h:outputLabel>
                    </p:column>

                    <p:column  rendered="#{bolsaController.admin}" sortBy="editar" headerText="Editar">
                        <p:commandButton ajax="false" value="Editar" >
                            <f:setPropertyActionListener target="#{bolsaController.documento}" value="#{item}" />
                        </p:commandButton>
                    </p:column>

                    <p:column rendered="#{bolsaController.admin}" sortBy="remover" headerText="Remover" >
                        <p:commandButton ajax="false" value="Remover" action="#{bolsaController.removeDocumento()}">
                            <f:setPropertyActionListener target="#{bolsaController.documento}" value="#{item}" />
                        </p:commandButton>
                    </p:column>
                </p:dataTable>
            </p:tab>

            <ui:include src="tabSeguranca.xhtml">
                <ui:param name="controller" value="#{bolsaController}"  />
            </ui:include>
        </p:tabView>
        <ui:include src="botoesEntidade.xhtml">
            <ui:param name="controller" value="#{bolsaController}"  />
        </ui:include>
        (*) Campos de Preenchimento Obrigatório
    </p:panel>
</ui:composition>